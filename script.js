// Object changed and it's working and also rn is removed.
// Score is also added and it is showing current time score.

const question = [

  {
    Id_Game: 10,
    Start_Date: null,
    Expiry_Date: null,
    Id_Assessment_question: 79,
    Id_Assessment: 14,
    Assessment_Question: "1.भारत के वर्तमान सीईओ कौन हैं?",
    allow_attempt: 1,
    Previous_button: 0,
    Assessment_Type: 4,
    assessment_question_url: null,
    Timer: 30,
    optionList: [
      {
        Id_Assessment_question_ans: 280,
        Id_Assessment_question: 79,
        Answer_Description: "a)गुंजन शाहrn",
        Right_Ans: 1,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701946587000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 281,
        Id_Assessment_question: 79,
        Answer_Description: "b)संदीप कटारिया",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701946621000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 282,
        Id_Assessment_question: 79,
        Answer_Description: "ग) क्रिस किर्क",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701946648000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 283,
        Id_Assessment_question: 79,
        Answer_Description: "d)इनमें से कोई नहीं",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701946673000)",
        Id_CmsUser: 21,
      },
    ],
  },
  {
    Id_Game: 10,
    Start_Date: null,
    Expiry_Date: null,
    Id_Assessment_question: 80,
    Id_Assessment: 14,
    Assessment_Question: "3.बाटा इंडिया लिमिटेड (BIL) की शुरुआत हुई:rn",
    allow_attempt: 1,
    Previous_button: 0,
    Assessment_Type: 4,
    assessment_question_url: null,
    Timer: 30,
    optionList: [
      {
        Id_Assessment_question_ans: 288,
        Id_Assessment_question: 80,
        Answer_Description: "ए)1894",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947726000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 289,
        Id_Assessment_question: 80,
        Answer_Description: "बी)1931",
        Right_Ans: 1,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947748000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 290,
        Id_Assessment_question: 80,
        Answer_Description: "ग)1936",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947769000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 291,
        Id_Assessment_question: 80,
        Answer_Description: "घ) उपरोक्त में से कोई नहीं",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947796000)",
        Id_CmsUser: 21,
      },
    ],
  },
  {
    Id_Game: 10,
    Start_Date: null,
    Expiry_Date: null,
    Id_Assessment_question: 81,
    Id_Assessment: 14,
    Assessment_Question: "4. भारत में 3 विनिर्माण इकाइयों के नाम बताइए।",
    allow_attempt: 1,
    Previous_button: 0,
    Assessment_Type: 4,
    assessment_question_url: null,
    Timer: 30,
    optionList: [
      {
        Id_Assessment_question_ans: 292,
        Id_Assessment_question: 81,
        Answer_Description: "ए) बाटा नगर,",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947821000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 293,
        Id_Assessment_question: 81,
        Answer_Description: "b) बाटा गंज",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947844000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 294,
        Id_Assessment_question: 81,
        Answer_Description: "c) बता शतक",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947866000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 295,
        Id_Assessment_question: 81,
        Answer_Description: "D। उपरोक्त सभी",
        Right_Ans: 1,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947885000)",
        Id_CmsUser: 21,
      },
    ],
  },
  {
    Id_Game: 10,
    Start_Date: null,
    Expiry_Date: null,
    Id_Assessment_question: 82,
    Id_Assessment: 14,
    Assessment_Question: "5. बाटा कंपनी की दुनिया भर में __ उत्पादन इकाई है।",
    allow_attempt: 1,
    Previous_button: 0,
    Assessment_Type: 4,
    assessment_question_url: null,
    Timer: 30,
    optionList: [
      {
        Id_Assessment_question_ans: 296,
        Id_Assessment_question: 82,
        Answer_Description: "ए) 32",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947915000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 297,
        Id_Assessment_question: 82,
        Answer_Description: "बी)34",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947936000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 298,
        Id_Assessment_question: 82,
        Answer_Description: "ग) 26",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947961000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 299,
        Id_Assessment_question: 82,
        Answer_Description: "घ) 26",
        Right_Ans: 1,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947977000)",
        Id_CmsUser: 21,
      },
    ],
  },
  {
    Id_Game: 10,
    Start_Date: null,
    Expiry_Date: null,
    Id_Assessment_question: 83,
    Id_Assessment: 14,
    Assessment_Question: "6.BC की उपस्थिति __ से अधिक देशों में है।",
    allow_attempt: 1,
    Previous_button: 0,
    Assessment_Type: 4,
    assessment_question_url: null,
    Timer: 30,
    optionList: [
      {
        Id_Assessment_question_ans: 300,
        Id_Assessment_question: 83,
        Answer_Description: "ए)50+",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947998000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 301,
        Id_Assessment_question: 83,
        Answer_Description: "बी)70+",
        Right_Ans: 1,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948021000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 302,
        Id_Assessment_question: 83,
        Answer_Description: "ग)80+",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948064000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 303,
        Id_Assessment_question: 83,
        Answer_Description: "घ)100+",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948092000)",
        Id_CmsUser: 21,
      },
    ],
  },
  {
    Id_Game: 10,
    Start_Date: null,
    Expiry_Date: null,
    Id_Assessment_question: 84,
    Id_Assessment: 14,
    Assessment_Question: "7.BCP का पूर्ण रूप क्या है?",
    allow_attempt: 1,
    Previous_button: 0,
    Assessment_Type: 4,
    assessment_question_url: null,
    Timer: 30,
    optionList: [
      {
        Id_Assessment_question_ans: 304,
        Id_Assessment_question: 84,
        Answer_Description: "a) बाटा चैट प्रोग्राम",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948118000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 305,
        Id_Assessment_question: 84,
        Answer_Description: "b)बाटा चिल्ड्रेन प्रोग्राम",
        Right_Ans: 1,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948144000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 306,
        Id_Assessment_question: 84,
        Answer_Description: "c) बाटा कॉर्पोरेशन प्रोग्राम",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948166000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 307,
        Id_Assessment_question: 84,
        Answer_Description: "d)बाटा कंपनी प्रोफाइलrn",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948192000)",
        Id_CmsUser: 21,
      },
    ],
  },
  {
    Id_Game: 10,
    Start_Date: null,
    Expiry_Date: null,
    Id_Assessment_question: 85,
    Id_Assessment: 14,
    Assessment_Question: "rnrn8)बाटा कंपनी की शुरुआत कब हुई?rn",
    allow_attempt: 1,
    Previous_button: 0,
    Assessment_Type: 4,
    assessment_question_url: null,
    Timer: 30,
    optionList: [
      {
        Id_Assessment_question_ans: 308,
        Id_Assessment_question: 85,
        Answer_Description: "1894rn",
        Right_Ans: 1,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948219000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 309,
        Id_Assessment_question: 85,
        Answer_Description: "बी) 1856",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948240000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 310,
        Id_Assessment_question: 85,
        Answer_Description: "ग) 1908",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948263000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 311,
        Id_Assessment_question: 85,
        Answer_Description: "घ) 1915",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948289000)",
        Id_CmsUser: 21,
      },
    ],
  },
  {
    Id_Game: 10,
    Start_Date: null,
    Expiry_Date: null,
    Id_Assessment_question: 86,
    Id_Assessment: 14,
    Assessment_Question: "9. BIL के भारत में __ संख्या में स्टोर हैं।",
    allow_attempt: 1,
    Previous_button: 0,
    Assessment_Type: 4,
    assessment_question_url: null,
    Timer: 30,
    optionList: [
      {
        Id_Assessment_question_ans: 312,
        Id_Assessment_question: 86,
        Answer_Description: "ए) 1558",
        Right_Ans: 1,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948324000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 313,
        Id_Assessment_question: 86,
        Answer_Description: "बी) 1200",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948340000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 314,
        Id_Assessment_question: 86,
        Answer_Description: "ग) 1100",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948370000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 315,
        Id_Assessment_question: 86,
        Answer_Description: "घ) 5000",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948416000)",
        Id_CmsUser: 21,
      },
    ],
  },
  {
    Id_Game: 10,
    Start_Date: null,
    Expiry_Date: null,
    Id_Assessment_question: 87,
    Id_Assessment: 14,
    Assessment_Question:
      "10.कंप्यूटर सीखना विज्ञान प्रयोगशालाओं तक पहुंच किस कार्यक्रम के अंतर्गत आता है?",
    allow_attempt: 1,
    Previous_button: 0,
    Assessment_Type: 4,
    assessment_question_url: null,
    Timer: 30,
    optionList: [
      {
        Id_Assessment_question_ans: 316,
        Id_Assessment_question: 87,
        Answer_Description: "क) गर्व के साथ आगे बढ़ें।",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948447000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 317,
        Id_Assessment_question: 87,
        Answer_Description: "ख) नन्हीं कली।",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948467000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 318,
        Id_Assessment_question: 87,
        Answer_Description: "ग) एसटीईएम कार्यक्रम।",
        Right_Ans: 1,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948492000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 319,
        Id_Assessment_question: 87,
        Answer_Description: "घ) हैप्पी फीट।",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701948517000)",
        Id_CmsUser: 21,
      },
    ],
  },
  {
    Id_Game: 10,
    Start_Date: null,
    Expiry_Date: null,
    Id_Assessment_question: 88,
    Id_Assessment: 14,
    Assessment_Question: "2.BIL का पूर्ण रूप क्या है?",
    allow_attempt: 1,
    Previous_button: 0,
    Assessment_Type: 4,
    assessment_question_url: null,
    Timer: 30,
    optionList: [
      {
        Id_Assessment_question_ans: 284,
        Id_Assessment_question: 88,
        Answer_Description: "a) बाटा इंडिया लिमिटrn",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947631000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 285,
        Id_Assessment_question: 88,
        Answer_Description: "b) बाटा इंडियन लिमिटेडrn",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947650000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 286,
        Id_Assessment_question: 88,
        Answer_Description: "c) बाटा इंडिया लिमिटेडrn",
        Right_Ans: 1,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947675000)",
        Id_CmsUser: 21,
      },
      {
        Id_Assessment_question_ans: 287,
        Id_Assessment_question: 88,
        Answer_Description: "d)इनमें से कोई नहीं",
        Right_Ans: 2,
        Score_Coins: 10,
        ID_ORGANIZATION: 15,
        IsActive: "A",
        Updated_Date_Time: "Date(1701947701000)",
        Id_CmsUser: 21,
      },
    ],
  },
];

// async function getDetails(url = 'https://www.playtolearn.in/TGCGame/api/GetAssessmentDataList?OrgID=15&UID=8037') {
//   try {
//     const response = await fetch(url, { method: 'GET' });

//     if (!response.ok) {
//       throw new Error(`Network response was not ok, status code: ${response.status}`);
//     }

//     const encryptedData = await response.json();
//     question=JSON.parse(encryptedData)
//     console.log('ResponseData',question);
//      // Assuming the response is the encrypted dat

//     return encryptedData;
//   } catch (error) {
//     console.error('Fetch error:', error.message);
//     throw error;
//   }
// }

function initializePage() {
  try {
    //  Login();
    getDetails();
  } catch (error) {
    // console.error('Error during initialization:', error.message);
  }
}

document.addEventListener("DOMContentLoaded", initializePage);
let currentQuestionIndex = 0;
let appleFallInterval1;
let isPopupOpen = false;
let userScore = 0;
let touchStartX;
let basketStartX;

let blueberryFallInterval1;
let bananaFallInterval1;

function gameplay() {
  document.getElementById("loadingpage").style.display = "none";
  document.querySelector(".gamecontainer").style.display = "flex";

  startGame();
}

function startGame() {
  const gameContainer = document.querySelector(".gamecontainer");
  const basket = document.getElementById("basket");
  const windowWidth = window.innerWidth;
  const basketWidth = basket.offsetWidth;
  const basketSpeed = 15;
  const appleSpeed = 2;
  const orangeSpeed = 1.2;
  const bananaSpeed = 1.5;
  const blueberrySpeed = 1.7;

  let apple1 = document.getElementById("apple1");
  let orange1 = document.getElementById("orange1");
  let banana1 = document.getElementById("banana1");
  let blueberry2 = document.getElementById("blueberry1");

  resetApple(apple1);
  resetOrange(orange1);
  resetBlueberry(blueberry2);
  resetBanana(banana1);

  document.addEventListener("keydown", moveBasket);
  document.addEventListener("touchstart", handleTouchStart);
  document.addEventListener("touchmove", handleTouchMove);

  appleFallInterval1 = setInterval(() => {
    if (!isPopupOpen) {
      fallApple(apple1);
      fallOrange(orange1);
      fallBlueberry(blueberry2);
      fallBanana(banana1);
      checkCollision(apple1); // Move checkCollision outside fallApple
    }
  }, -10);

  document.addEventListener("keydown", moveBasket);

  document.addEventListener("touchstart", handleTouchStart);
  document.addEventListener("touchmove", handleTouchMove);

  function handleTouchStart(event) {
    touchStartX = event.touches[0].clientX;
    basketStartX = parseFloat(basket.style.left) || 0;
  }

  function handleTouchMove(event) {
    event.preventDefault();
    if (touchStartX !== undefined && basketStartX !== undefined) {
      const touchX = event.touches[0].clientX;
      const deltaX = touchX - touchStartX;
      let newLeft = basketStartX + deltaX;

      const windowWidth = window.innerWidth;
      const basketWidth = basket.offsetWidth;

      newLeft = Math.min(Math.max(newLeft, 0), windowWidth - basketWidth - 15);
      basket.style.left = newLeft + 40  + "px";
    }
  }

  document.addEventListener("touchend", function (e) {
    touchStartX = undefined;
    basketStartX = undefined;
  });


  function moveBasket(e) {
    const deviceWidth = window.innerWidth;
    const vw = window.innerWidth / 100;

    let minLeft = 10;
    let maxRight = 90;

    if (deviceWidth < 768) {
      minLeft = 10;
      maxRight = 90;
    }

    if (e.key === "ArrowLeft") {
      const newLeft = Math.max(minLeft, (basket.offsetLeft - basketSpeed) / vw);
      basket.style.left = `${newLeft}vw`;
    } else if (e.key === "ArrowRight") {
      const newRight = Math.min(
        maxRight,
        (basket.offsetLeft + basketSpeed) / vw
      );
      basket.style.left = `${newRight}vw`;
    }

    checkCollision();
  }

  function fallApple(apple) {
    const currentTop = apple.offsetTop;

    if (currentTop + apple.offsetHeight >= window.innerHeight - 90) {
      checkCollision(apple);
      resetApple(apple);
    } else {
      apple.style.top = currentTop + appleSpeed + "px";
    }
  }

  function fallOrange(orange) {
    const currentTop = orange.offsetTop;

    if (currentTop + orange.offsetHeight >= window.innerHeight - 90) {
      checkCollision(orange);
      resetOrange(orange);
    } else {
      orange.style.top = currentTop + orangeSpeed + "px";
    }
  }

  function resetOrange(orange) {
    const randomLeft = Math.floor(
      Math.random() * (windowWidth - orange.offsetWidth)
    );
    orange.style.left = randomLeft + "px";

    orange.style.top = -orange.offsetHeight + "px";
  }

  function fallBlueberry(blueberry) {
    const currentTop = blueberry.offsetTop;

    if (currentTop + blueberry.offsetHeight >= window.innerHeight - 90) {
      checkCollision(blueberry);
      resetBlueberry(blueberry);
    } else {
      blueberry.style.top = currentTop + blueberrySpeed + "px";
    }
  }

  function resetBanana(banana) {
    const randomLeft = Math.floor(
      Math.random() * (windowWidth - banana.offsetWidth)
    );
    banana.style.left = randomLeft + "px";

    banana.style.top = -banana.offsetHeight + "px";
  }
  function fallBanana(banana) {
    const currentTop = banana.offsetTop;

    if (currentTop + banana.offsetHeight >= window.innerHeight - 90) {
      checkCollision(banana);
      resetBanana(banana);
    } else {
      banana.style.top = currentTop + bananaSpeed + "px";
    }
  }

  function resetBlueberry(blueberry) {
    const randomLeft = Math.floor(
      Math.random() * (windowWidth - blueberry.offsetWidth)
    );
    blueberry.style.left = randomLeft + "px";

    blueberry.style.top = -blueberry.offsetHeight + "px";
  }

  let collisionDetected = false;

  function checkCollision() {
    if (collisionDetected) {
      return;
    }

    const basketRect = basket.getBoundingClientRect();
    const appleRect1 = apple1.getBoundingClientRect();

    if (
      basketRect.left < appleRect1.right &&
      basketRect.right > appleRect1.left &&
      basketRect.top < appleRect1.bottom &&
      basketRect.bottom > appleRect1.top
    ) {
      clearInterval(appleFallInterval1);
      collisionDetected = true;

      showPopup(
        question[currentQuestionIndex].Assessment_Question,
        question[currentQuestionIndex].optionList
      );

      currentQuestionIndex++;

      if (currentQuestionIndex <= question.length) {
        resetApple(apple1);
        startGame();
      } else {
        showCongratulationsPopup();
      }
    } else {
      showCongratulationsPopup();
    }
  }

  function resetApple(apple) {
    const randomLeft = Math.floor(
      Math.random() * (windowWidth - apple.offsetWidth)
    );
    apple.style.left = randomLeft + "px";

    apple.style.top = -apple.offsetHeight + "px";
  }

  function showPopup(question, options) {
    const popup = document.getElementById("popup");
    const questionElement = document.getElementById("question");
    const optionsForm = document.getElementById("optionsForm");

    question = question.replace(/rn/g, "");

    questionElement.innerHTML = `
            <div class="question">
                ${question}
            </div>`;

    optionsForm.innerHTML = "";

    options.forEach((option, index) => {
      const optionBox = document.createElement("div");
      optionBox.classList.add("option-box");

      const label = document.createElement("label");
      const answerDescription = option.Answer_Description.replace(/rn/g, "");
      label.innerText = answerDescription;
      label.addEventListener("click", function () {
        closePopup();
        handleAnswer(option.Right_Ans);
      });

      optionBox.appendChild(label);
      optionsForm.appendChild(optionBox);
    });

    popup.style.display = "block";
    isPopupOpen = true;
  }

  function handleAnswer(rightAnswer) {
    if (rightAnswer === 1) {
      userScore += 10;
      updateScoreDisplay();
    }
  }

  function updateScoreDisplay() {
    const scoreElement = document.getElementById("score");
    scoreElement.textContent = `Score: ${userScore}`;
  }

  function closePopup() {
    const popup = document.getElementById("popup");
    popup.style.display = "none";

    isPopupOpen = false;
  }

  function showCongratulationsPopup() {
    if (currentQuestionIndex === question.length && !isPopupOpen) {
      const congratulationsPopup = document.createElement("div");
      congratulationsPopup.className = "congratulations-popup";

      const congratulationsMessage = document.createElement("p");
      congratulationsMessage.textContent =
        "Congratulations! You have completed the quiz. Thank you for participating.";

      const restartButton = document.createElement("button");
      restartButton.textContent = "Restart";
      restartButton.addEventListener("click", function () {
        location.reload();
      });

      congratulationsPopup.appendChild(congratulationsMessage);
      congratulationsPopup.appendChild(restartButton);

      document.body.appendChild(congratulationsPopup);
      isPopupOpen = true;
    }
  }
}
